[
  {
    "name": "session_id",
    "type": "STRING",
    "mode": "REQUIRED",
    "description": "Unique session identifier for the trading run"
  },
  {
    "name": "agent_id",
    "type": "STRING",
    "mode": "REQUIRED",
    "description": "Agent identifier"
  },
  {
    "name": "decision_point",
    "type": "INTEGER",
    "mode": "REQUIRED",
    "description": "Decision point number in the session"
  },
  {
    "name": "stage",
    "type": "STRING",
    "mode": "REQUIRED",
    "description": "Execution stage: PRENEXT, NEXTSTART, or NEXT"
  },
  {
    "name": "timestamp",
    "type": "TIMESTAMP",
    "mode": "REQUIRED",
    "description": "Decision timestamp (when recorded)"
  },
  {
    "name": "bar_time",
    "type": "TIMESTAMP",
    "mode": "REQUIRED",
    "description": "Market bar timestamp"
  },
  {
    "name": "action",
    "type": "STRING",
    "mode": "REQUIRED",
    "description": "Decision category: INACTIVE (strategy warming up), HOLD (evaluated but no trade), or TRADED (executed trades - see event_timeline for details)"
  },
  {
    "name": "portfolio_value",
    "type": "FLOAT",
    "mode": "REQUIRED",
    "description": "Total portfolio value at decision time"
  },
  {
    "name": "portfolio_cash",
    "type": "FLOAT",
    "mode": "REQUIRED",
    "description": "Available cash at decision time"
  },
  {
    "name": "data_accessed",
    "type": "RECORD",
    "mode": "REPEATED",
    "description": "Data feeds and fields accessed for this decision",
    "fields": [
      {
        "name": "symbol",
        "type": "STRING",
        "mode": "REQUIRED",
        "description": "Symbol of data feed accessed"
      },
      {
        "name": "data_hash",
        "type": "STRING",
        "mode": "NULLABLE",
        "description": "Hash of complete data point from ingestion"
      },
      {
        "name": "fields_accessed",
        "type": "STRING",
        "mode": "REPEATED",
        "description": "List of fields accessed (e.g., close, high, news_headline)"
      },
      {
        "name": "access_patterns",
        "type": "RECORD",
        "mode": "REPEATED",
        "description": "Detailed access patterns",
        "fields": [
          {
            "name": "seq",
            "type": "INTEGER",
            "mode": "REQUIRED",
            "description": "Access sequence number"
          },
          {
            "name": "timestamp_ns",
            "type": "INTEGER",
            "mode": "REQUIRED",
            "description": "Nanosecond timestamp of access"
          },
          {
            "name": "field",
            "type": "STRING",
            "mode": "REQUIRED",
            "description": "Field accessed"
          },
          {
            "name": "index",
            "type": "INTEGER",
            "mode": "REQUIRED",
            "description": "Array index (0 for current, -1 for previous)"
          }
        ]
      }
    ]
  },
  {
    "name": "access_count",
    "type": "INTEGER",
    "mode": "REQUIRED",
    "description": "Total number of field accesses for this decision"
  },
  {
    "name": "event_timeline",
    "type": "RECORD",
    "mode": "REPEATED",
    "description": "Unified timeline of all events (data accesses and trades) in exact sequence. Enables replaying the agent's decision process step-by-step.",
    "fields": [
      {
        "name": "seq",
        "type": "INTEGER",
        "mode": "REQUIRED",
        "description": "Global sequence number across all event types (1, 2, 3...). Defines exact order of events."
      },
      {
        "name": "timestamp_ns",
        "type": "INTEGER",
        "mode": "REQUIRED",
        "description": "Nanosecond-precision timestamp when this event occurred."
      },
      {
        "name": "event_type",
        "type": "STRING",
        "mode": "REQUIRED",
        "description": "Type of event: 'DATA_ACCESS' (model read a field) or 'TRADE' (model executed a trade)"
      },
      {
        "name": "symbol",
        "type": "STRING",
        "mode": "REQUIRED",
        "description": "Asset symbol this event relates to (e.g., 'AAPL')"
      },
      {
        "name": "field",
        "type": "STRING",
        "mode": "NULLABLE",
        "description": "For DATA_ACCESS: which field was read (e.g., 'close', 'volume'). NULL for TRADE events."
      },
      {
        "name": "index",
        "type": "INTEGER",
        "mode": "NULLABLE",
        "description": "For DATA_ACCESS: historical offset (0=current, -1=previous bar). NULL for TRADE events."
      },
      {
        "name": "action",
        "type": "STRING",
        "mode": "NULLABLE",
        "description": "For TRADE: 'BUY' or 'SELL'. NULL for DATA_ACCESS events."
      },
      {
        "name": "size",
        "type": "FLOAT",
        "mode": "NULLABLE",
        "description": "For TRADE: number of shares/units traded. NULL for DATA_ACCESS events."
      },
      {
        "name": "price",
        "type": "FLOAT",
        "mode": "NULLABLE",
        "description": "For TRADE: execution price per share/unit. NULL for DATA_ACCESS events."
      },
      {
        "name": "value",
        "type": "FLOAT",
        "mode": "NULLABLE",
        "description": "For TRADE: total order value (size * price). NULL for DATA_ACCESS events."
      },
      {
        "name": "commission",
        "type": "FLOAT",
        "mode": "NULLABLE",
        "description": "For TRADE: commission/fees paid for this trade. NULL for DATA_ACCESS events."
      },
      {
        "name": "pnl",
        "type": "FLOAT",
        "mode": "NULLABLE",
        "description": "For TRADE: realized profit/loss if closing a position. NULL for opening trades and DATA_ACCESS events."
      },
      {
        "name": "data_hash",
        "type": "STRING",
        "mode": "NULLABLE",
        "description": "For DATA_ACCESS: SHA-256 hash linking to data_registry for the data that was read. NULL for TRADE events."
      }
    ]
  },
  {
    "name": "positions",
    "type": "RECORD",
    "mode": "REPEATED",
    "description": "Current positions after decision",
    "fields": [
      {
        "name": "symbol",
        "type": "STRING",
        "mode": "REQUIRED"
      },
      {
        "name": "size",
        "type": "FLOAT",
        "mode": "REQUIRED"
      },
      {
        "name": "price",
        "type": "FLOAT",
        "mode": "REQUIRED",
        "description": "Average entry price"
      },
      {
        "name": "value",
        "type": "FLOAT",
        "mode": "REQUIRED",
        "description": "Position value"
      }
    ]
  },
  {
    "name": "inserted_at",
    "type": "TIMESTAMP",
    "mode": "REQUIRED",
    "description": "When record was inserted into BigQuery",
    "defaultValueExpression": "CURRENT_TIMESTAMP()"
  }
]